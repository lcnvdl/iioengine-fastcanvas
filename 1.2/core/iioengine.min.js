(function(){Array.prototype.forEach||(Array.prototype.forEach=function(a){for(var g=!0,d=0;d<this.length;d++)for(var b=0;b<this[d].length;b++)if(g=a(this[d][b],d,b),"undefined"!=typeof g&&!g)return[b,d]});Array.prototype.insert||(Array.prototype.insert=function(a,g){this.splice(a,0,g)});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)});var b=window.CanvasRenderingContext2D&&CanvasRenderingContext2D.prototype;b.lineTo&&(b.dashedLine=b.dashedLine||function(a,g,
d,b,h){h||(h=[10,5]);this.save();d-=a;var k=b-g;b=Math.sqrt(d*d+k*k);d=Math.atan2(k,d);this.translate(a,g);this.moveTo(0,0);this.rotate(d);g=h.length;d=0;k=!0;for(a=0;b>a;)a+=h[d++%g],a>b&&(a=b),k?this.lineTo(a,0):this.moveTo(a,0),k=!k;this.restore()})})();var iio={};
(function(b){function a(){}b.__newImage=function(){return"undefined"!==typeof FastCanvas?FastCanvas.createImage():new Image};b.__newCanvas=function(a){if("undefined"!==typeof FastCanvas)return FastCanvas.create();var d=document.createElement("canvas");a(d);return d};b.maxInt=9007199254740992;b.inherit=function(g,d){a.prototype=d.prototype;g.prototype=new a;g.prototype.constructor=g};b.start=function(a,d,e,h){if("undefined"==typeof a)throw Error("iio.start: No application script provided");"undefined"==
typeof b.apps&&(b.apps=[]);b.apps[b.apps.length]=new b.AppManager(a,d,e,h);return b.apps[b.apps.length-1]};b.stop=function(a){if(b.isNumber(a))b.apps.splice(a,1);else for(var d=0;d<b.apps.length;d++)b.apps[d]==a&&b.apps.splice(d,1)};b.requestTimeout=function(a,d,b,h){var k=(new Date).getTime(),l=Math.max(0,1E3/a-(k-d));h[0].fsID=setTimeout(function(){b(k+l,h)},l);d=k+l};b.loadImage=function(a,d){var e=b.__newImage();e.src=a;e.onload=d;return e};b.isNumber=function(a){return"number"===typeof a?!0:
a-0==a&&0<a.length};b.isString=function(a){return"string"==typeof a||a instanceof String};b.isBetween=function(a,d,b){if(b<d){var h=d;d=b;b=h}return a>=d&&a<=b};b.addEvent=function(a,d,b,h){return a.addEventListener?(a.addEventListener(d,b,h),!0):a.attachEvent?(a.attachEvent("on"+d,b),!0):!1};b.delayCall=function(a,d,b){setTimeout(function(){d(b)},a)};b.rotatePoint=function(a,d,e){"undefined"!=typeof a.x&&(e=d,d=a.y,a=a.x);if("undefined"==typeof e||0==e)return new b.Vec(a,d);var h=a*Math.cos(e)-d*
Math.sin(e);a=d*Math.cos(e)+a*Math.sin(e);return new b.Vec(h,a)};b.getRandomNum=function(a,d){a=a||0;d=d||1;return Math.random()*(d-a)+a};b.getRandomInt=function(a,d){return Math.floor(Math.random()*(d-a))+a};b.getRandomColor=function(){var a=Math.floor(255*Math.random()+0),d=Math.floor(255*Math.random()+0),b=Math.floor(255*Math.random()+0);return"rgb("+a+","+d+","+b+")"};b.getVecsFromPointList=function(a){for(var d=[],e=0;e<a.length;e++)"undefined"!=typeof a[e].x?d[d.length]=new b.Vec(a[e]):(d[d.length]=
new b.Vec(a[e],a[e+1]),e++);return d};b.getCentroid=function(a){for(var d,e,h=0;h<a.length;h++)d+=a[h].x,e+=a[h].y;return new b.Vec(d/a.length,e/a.length)};b.getSpecVertex=function(a,d){for(var b=a[0],h=0;h<a.length;h++)d(b,a[h])&&(b=a[h]);return b};b.lineContains=function(a,d,e){return b.isBetween(e.x,a.x,d.x)&&b.isBetween(e.y,a.y,d.y)&&(d=(d.y-a.y)/(d.x-a.x),!isFinite(d)||d*(x-a.x)+a.y==e.y)?!0:!1};b.intersects=function(a,d){if(a instanceof b.SimpleRect){if(d instanceof b.SimpleRect)return b.rectXrect(a,
d);if(d instanceof b.Circle)return b.polyXcircle(a,d);if(d instanceof b.Poly)return b.polyXpoly(a,d)}if(a instanceof b.Poly){if(d instanceof b.Circle)return b.polyXcircle(a,d);if(d instanceof b.Poly)return b.polyXpoly(a,d,a.getTrueVertices(),d.getTrueVertices())}if(a instanceof b.Circle){if(d instanceof b.Circle)return b.circleXcircle(a,d);if(d instanceof b.Poly)return b.polyXcircle(d,a)}};b.lineXline=function(a,d,e,h){var k=(d.y-a.y)/(d.x-a.x),l=(h.y-e.y)/(h.x-e.x),m=k,n=a.x,u=a.y,r=!isFinite(k),
v=!isFinite(l);if(r||v){if(r&&v)return a.x===e.x&&(b.isBetween(a.y,e.y,h.y)||b.isBetween(d.y,e.y,h.y)||b.isBetween(e.y,a.y,d.y)||b.isBetween(h.y,a.y,d.y));r?(k=a.x,m=l,n=e.x,u=e.y):k=e.x}else if(k=(k*a.x-l*e.x-a.y+e.y)/(k-l),!isFinite(k))return b.isBetween(a.x,e.x,h.x)&&b.isBetween(a.y,e.y,h.y)||b.isBetween(d.x,e.x,h.x)&&b.isBetween(d.y,e.y,h.y)||b.isBetween(e.x,a.x,d.x)&&b.isBetween(e.y,a.y,d.y)||b.isBetween(h.x,a.x,d.x)&&b.isBetween(h.y,a.y,d.y);l=m*(k-n)+u;return b.isBetween(k,a.x,d.x)&&b.isBetween(k,
e.x,h.x)&&b.isBetween(l,a.y,d.y)&&b.isBetween(l,e.y,h.y)?!0:!1};b.rectXrect=function(a,d){return a.left()<d.right()&&a.right()>d.left()&&a.top()<d.bottom()&&a.bottom()>d.top()?!0:!1};b.polyXpoly=function(a,d){var e=a.getTrueVertices(),h=d.getTrueVertices();for(i=0;i<e.length;i++)if(d.contains(e[i]))return!0;for(i=0;i<h.length;i++)if(a.contains(h[i]))return!0;var k,l,m;for(i=0;i<e.length;i++){k=b.Vec.add(e[i],a.pos);l=b.Vec.add(e[(i+1)%e.length],a.pos);for(m=0;m<h.length;m++)if(b.lineXline(k,l,b.Vec.add(h[m],
d.pos),b.Vec.add(h[(m+1)%h.length],d.pos)))return!0}return!1};b.circleXcircle=function(a,d){return a.pos.distance(d.pos)<a.radius+d.radius?!0:!1};b.polyXcircle=function(a,d){var b=a.getTrueVertices(),h;for(h=0;h<b.length;h++)if(d.contains(b[h]))return!0;var k;for(h=0;h<b.length;h++)if(k=h+1,k==b.length&&(k=0),d.lineIntersects(b[h],b[k]))return!0;return!1};b.getKeyString=function(a){switch(a.keyCode){case 8:return"backspace";case 9:return"tab";case 13:return"enter";case 16:return"shift";case 17:return"ctrl";
case 18:return"alt";case 19:return"pause";case 20:return"caps lock";case 27:return"escape";case 32:return"space";case 33:return"page up";case 34:return"page down";case 35:return"end";case 36:return"home";case 37:return"left arrow";case 38:return"up arrow";case 39:return"right arrow";case 40:return"down arrow";case 45:return"insert";case 46:return"delete";case 48:return"0";case 49:return"1";case 50:return"2";case 51:return"3";case 52:return"4";case 53:return"5";case 54:return"6";case 55:return"7";
case 56:return"8";case 57:return"9";case 65:return"a";case 66:return"b";case 67:return"c";case 68:return"d";case 69:return"e";case 70:return"f";case 71:return"g";case 72:return"h";case 73:return"i";case 74:return"j";case 75:return"k";case 76:return"l";case 77:return"m";case 78:return"n";case 79:return"o";case 80:return"p";case 81:return"q";case 82:return"r";case 83:return"s";case 84:return"t";case 85:return"u";case 86:return"v";case 87:return"w";case 88:return"x";case 89:return"y";case 90:return"z";
case 91:return"left window";case 92:return"right window";case 93:return"select key";case 96:return"n0";case 97:return"n1";case 98:return"n2";case 99:return"n3";case 100:return"n4";case 101:return"n5";case 102:return"n6";case 103:return"n7";case 104:return"n8";case 105:return"n9";case 106:return"multiply";case 107:return"add";case 109:return"subtract";case 110:return"dec";case 111:return"divide";case 112:return"f1";case 113:return"f2";case 114:return"f3";case 115:return"f4";case 116:return"f5";case 117:return"f6";
case 118:return"f7";case 119:return"f8";case 120:return"f9";case 121:return"f10";case 122:return"f11";case 123:return"f12";case 144:return"num lock";case 156:return"scroll lock";case 186:return"semi-colon";case 187:return"equal";case 188:return"comma";case 189:return"dash";case 190:return"period";case 191:return"forward slash";case 192:return"grave accent";case 219:return"open bracket";case 220:return"back slash";case 221:return"close bracket";case 222:return"single quote";default:return"undefined"}};
b.keyCodeIs=function(a,d){a instanceof Array||(a=[a]);for(var e=b.getKeyString(d),h=0;h<a.length;h++)if(e==a[h])return!0;return!1};"undefined"!=typeof soundManager&&(b.playSound=function(a){soundManager.createSound({url:a}).play({onfinish:function(){this.destruct()}})},b.loadSound=function(a,d){soundManager.createSound({url:a,onload:function(){soundManager._writeDebug(this.id+" loaded");d()}})})})(iio);
(function(){function b(){this.Vec.apply(this,arguments)}iio.Vec=b;b.prototype.Vec=function(a,g){"undefined"!=typeof a&&"undefined"!=typeof a.x?(this.x=a.x||0,this.y=a.y||0):(this.x=a||0,this.y=g||0)};b.prototype.clone=function(){return new b(this.x,this.y)};b.prototype.toString=function(){return"x:"+this.x+" y:"+this.y};b.toString=function(a){return"x:"+a.x+" y:"+a.y};b.prototype.set=function(a,g){"undefined"!=typeof a.x?(this.x=a.x,this.y=a.y):(this.x=a,this.y=g);return this};b.prototype.length=
function(){return Math.sqrt(this.x*this.x+this.y*this.y)};b.length=function(a,g){return"undefined"!=typeof a.x?Math.sqrt(a.x*a.x+a.y*a.y):Math.sqrt(a*a+g*g)};b.prototype.add=function(a,g){"undefined"!=typeof a.x?(this.x+=a.x,this.y+=a.y):(this.x+=a,this.y+=g);return this};b.add=function(a,g,d,e){return"undefined"!=typeof a.x?(new b(a)).add(g,d):(new b(a,g)).add(d,e)};b.prototype.sub=function(a,g){"undefined"!=typeof a.x?this.add(-a.x,-a.y):this.add(-a,-g);return this};b.sub=function(a,g,d,e){return"undefined"!=
typeof a.x?(new b(a)).sub(g,d):(new b(a,g)).sub(d,e)};b.prototype.mult=function(a){this.x*=a;this.y*=a;return this};b.mult=function(a,g,d){return"undefined"!=typeof a.x?(new b(a)).mult(g):(new b(a,g)).mult(d)};b.prototype.div=function(a){this.x/=a;this.y/=a;return this};b.div=function(a,g,d){return"undefined"!=typeof a.x?(new b(a)).div(g):(new b(a,g)).div(d)};b.prototype.dot=function(a,g){return"undefined"!=typeof a.x?this.x*a.x+this.y*a.y:this.x*a+this.y*g};b.dot=function(a,g,d,b){return"undefined"!=
typeof a.x?"undefined"!=typeof g.x?a.x*g.x+a.y*g.y:a.x*g+a.y*d:"undefined"!=typeof d.x?a*d.x+g*d.y:a*d+g*b};b.prototype.normalize=function(){this.div(this.length());return this};b.normalize=function(a,g){return(new b(a,g)).normalize()};b.prototype.lerp=function(a,g,d){"undefined"!=typeof a.x?this.add(b.sub(a,this).mult(g)):this.add(b.sub(a,g,this).mult(d));return this};b.lerp=function(a,g,d,e,h){return"undefined"!=typeof a.x?(new b(a)).lerp(g,d,e):(new b(a,g)).lerp(d,e,h)};b.prototype.distance=function(a,
g){return"undefined"!=typeof a.x?Math.sqrt((a.x-this.x)*(a.x-this.x)+(a.y-this.y)*(a.y-this.y)):Math.sqrt((a-this.x)*(a-this.x)+(g-this.y)*(g-this.y))};b.distance=function(a,g,d,b){return"undefined"!=typeof a.x?"undefined"!=typeof g.x?Math.sqrt((a.x-g.x)*(a.x-g.x)+(a.y-g.y)*(a.y-g.y)):Math.sqrt((a.x-g)*(a.x-g)+(a.y-d)*(a.y-d)):"undefined"!=typeof d.x?Math.sqrt((a-d.x)*(a-d.x)+(g-d.y)*(g-d.y)):Math.sqrt((a-d)*(a-d)+(g-b)*(g-b))}})();
(function(){function b(){this.Obj.apply(this,arguments)}iio.Obj=b;b.prototype.Obj=function(a,g){this.pos=new iio.Vec(a||0,g||0);this.styles={}};b.prototype.clone=function(){return new b(this.pos)};b.prototype.setPos=function(a,g){this.redraw=!0;this.pos=new iio.Vec(a,g);return this};b.prototype.translate=function(a,g){this.pos.add(a,g);this.redraw=!0;if("undefined"!=typeof this.objs)for(var d=0;d<this.objs.length;d++)this.objs[d].translate(a,g);return this};b.prototype.rotate=function(a){this.rotation=
a;return this};b.prototype.addObj=function(a,g,d,b,h){"undefined"==typeof this.objs&&(this.objs=[]);a.posOffset=new iio.Vec(b,h);a.pos=this.pos.clone();"undefined"!=typeof a.posOffset&&a.pos.add(a.posOffset);this.objs[this.objs.length]=a;this._draw=this.draw;this.draw=g?function(a){for(var d=0;d<this.objs.length;d++)this.objs[d].draw(a);this._draw(a)}:function(a){this._draw(a);for(var d=0;d<this.objs.length;d++)this.objs[d].draw(a)};"undefined"!=typeof d&&a.draw(d);return this.enableUpdates()};b.prototype.enableUpdates=
function(a,g){this._update=this.update;this.update="undefined"!=typeof this._update?function(d){var b=a(this,g);return!this._update(d)||"undefined"!=typeof b&&!b?!1:!0}:function(d){if("undefined"!=typeof this.objs)for(var b=0;b<this.objs.length;b++)"undefined"!=typeof this.objs[b].update&&this.objs[b].update(d),this.objs[b].pos.x=this.pos.x,this.objs[b].pos.y=this.pos.y,"undefined"!=typeof this.objs[b].posOffset&&this.objs[b].pos.add(this.objs[b].posOffset);"undefined"!=typeof this.fxFade&&("undefined"==
typeof this.styles&&alert("error: styles undefined"),0<this.fxFade.rate&&this.fxFade.alpha>this.styles.alpha||0>this.fxFade.rate&&this.fxFade.alpha<this.styles.alpha?(this.styles.alpha+=this.fxFade.rate,this.clearDraw(),0>this.styles.alpha&&(this.styles.alpha=0),1<this.styles.alpha&&(this.styles.alpha=1)):this.fxFade=void 0);return"undefined"!=typeof a?a(this,d,g):!0};return this}})();
(function(){function b(){this.Line.apply(this,arguments)}iio.Line=b;iio.inherit(b,iio.Obj);b.prototype._super=iio.Obj.prototype;b.prototype.Line=function(a,g,d,b){this._super.Obj.call(this,a,g);this.endPos=a instanceof iio.Vec?g instanceof iio.Vec?new iio.Vec(g):new iio.Vec(g,d):d instanceof iio.Vec?new iio.Vec(d):new iio.Vec(d,b)};b.prototype.clone=function(){return new b(this.pos.x,this.pos.y,this.endPos.x,this.endPos.y)};b.prototype.set=function(a,b,d,e){a instanceof iio.Line?(this.pos.x=a.pos.x,
this.pos.y=a.pos.y,this.endPos.x=a.endPos.x,this.endPos.y=a.endPos.y):a instanceof iio.Vec?(this.pos.x=a.x,this.pos.y=a.y,this.endPos.x=b.x,this.endPos.y=b.y):(this.pos.x=a,this.pos.y=b,this.endPos.x=d,this.enPos.y=e)};b.prototype.setDash=function(a){this.dashed="undefined"==typeof a?void 0:!0;this.dashProperties=a;return this};b.prototype.setEndPos=function(a,b){this.endPos=a instanceof iio.Vec?a:new iio.Vec(a||0,b||0)}})();
(function(){function b(){this.MultiLine.apply(this,arguments)}iio.MultiLine=b;iio.inherit(b,iio.Line);b.prototype._super=iio.Line.prototype;b.prototype.MultiLine=function(a){this.vertices=iio.getVecsFromPointList(a);this._super.Line.call(this,this.vertices[0],this.vertices[this.vertices.length-1])};b.prototype.clone=function(){return new b(this.vertices)}})();
(function(){function b(){this.Text.apply(this,arguments)}iio.Text=b;iio.inherit(b,iio.Obj);b.prototype._super=iio.Obj.prototype;b.prototype.Text=function(a,b,d){this._super.Obj.call(this,b,d);this.text=a};b.prototype.clone=function(){return(new b(this.text,this.pos)).setFont(this.font).setTextAlign(this.textAlign).setWrap(this.wrap).setLineHeight(this.lineheight)};b.prototype.keyboardEdit=function(a,b,d,e){a=iio.getKeyString(a);var h=this.text.substring(0,b),k=this.text.substring(b);if("undefined"!=
typeof e&&(e=e(a,d,h,k),!1!=e))return this.text=h+e+k,b+1;if(1<a.length){if("backspace"==a)return this.text=h.substring(0,h.length-1)+k,b-1;if("delete"==a)return this.text=h+k.substring(1),b;"semi-colon"==a&&(this.text=d?h+":"+k:h+";"+k,b++);"equal"==a&&(this.text=d?h+"+"+k:h+"="+k,b++);"comma"==a&&(this.text=d?h+"<"+k:h+","+k,b++);"dash"==a&&(this.text=d?h+"_"+k:h+"-"+k,b++);"period"==a&&(this.text=d?h+">"+k:h+"."+k,b++);"forward slash"==a&&(this.text=d?h+"?"+k:h+"/"+k,b++);"grave accent"==a&&(this.text=
d?h+"~"+k:h+"`"+k,b++);"open bracket"==a&&(this.text=d?h+"{"+k:h+"["+k,b++);"back slash"==a&&(this.text=d?h+"|"+k:h+"/"+k,b++);"close bracket"==a&&(this.text=d?h+"}"+k:h+"]"+k,b++);"single quote"==a&&(this.text=d?h+'"'+k:h+"'"+k,b++);"space"==a&&(this.text=h+" "+k,b++)}else this.text=d?h+a.charAt(0).toUpperCase()+k:h+a+k,b++;return b};b.prototype.getX=function(a,b){var d=this.text.substring(0,b);a.font=this.font;a.measureText(d);return this.left()+a.measureText(d).width};b.prototype.setText=function(a){this.text=
a;return this};b.prototype.addText=function(a){this.text+=a;return this};b.prototype.setFont=function(a){this.font=a;return this};b.prototype.setWrap=function(a){this.wrap=a;return this};b.prototype.setLineHeight=function(a){this.lineheight=a;return this};b.prototype.setTextAlign=function(a){this.textAlign=a;return this}})();
(function(){function b(){this.Shape.apply(this,arguments)}iio.Shape=b;iio.inherit(b,iio.Obj);b.prototype._super=iio.Obj.prototype;b.prototype.Shape=function(a,b){this._super.Obj.call(this,a,b)};b.prototype.clone=function(){return new b(this.pos)};b.prototype.setRotationAxis=function(a,b){this.rAxis=a instanceof iio.Vec?a.clone():new iio.Vec(a,b);return this}})();
(function(){function b(){this.SimpleRect.apply(this,arguments)}iio.SimpleRect=b;iio.inherit(b,iio.Shape);b.prototype._super=iio.Shape.prototype;b.prototype.SimpleRect=function(a,b,d,e){this._super.Shape.call(this,a,b);"undefined"!=typeof a&&"undefined"!=typeof a.x?(this.width=b||0,this.height=d||b||0):(this.width=d||0,this.height=e||d||0)};b.prototype.clone=function(){return new b(this.pos,this.width,this.height)};b.prototype.left=function(){return this.pos.x-this.width/2};b.prototype.right=function(){return this.pos.x+
this.width/2};b.prototype.top=function(){return this.pos.y-this.height/2};b.prototype.bottom=function(){return this.pos.y+this.height/2};b.prototype.setSize=function(a,b){"undefined"!=typeof a.x?(this.width=a.x||0,this.height=a.y||0):(this.width=a||0,this.height=b||0);return this};b.prototype.contains=function(a,b){b=a.y||b;a=a.x||a;a-=this.pos.x;b-=this.pos.y;return a>-0.5*this.width&&a<0.5*this.width&&b>-0.5*this.height&&b<0.5*this.height?!0:!1};b.prototype.getTrueVertices=function(){return iio.getVecsFromPointList([this.pos.x-
this.width/2,this.pos.y-this.height/2,this.pos.x+this.width/2,this.pos.y-this.height/2,this.pos.x+this.width/2,this.pos.y+this.height/2,this.pos.x-this.width/2,this.pos.y+this.height/2])}})();
(function(){function b(){this.Circle.apply(this,arguments)}iio.Circle=b;iio.inherit(b,iio.Shape);b.prototype._super=iio.Shape.prototype;b.prototype.Circle=function(a,b,d){this._super.Shape.call(this,a,b);this.radius="undefined"==typeof a||"undefined"!=typeof a.x?b||0:d||0};b.prototype.clone=function(){return new b(this.pos,this.radius)};b.prototype.left=function(){return this.pos.x-this.radius};b.prototype.right=function(){return this.pos.x+this.radius};b.prototype.top=function(){return this.pos.y-
this.radius};b.prototype.bottom=function(){return this.pos.y+this.radius};b.prototype.setRadius=function(a){this.radius=a||0;return this};b.prototype.contains=function(a){return a.distance(this.pos)<this.radius?!0:!1};b.prototype.lineIntersects=function(a,b){var d=(b.x-a.x)*(b.x-a.x)+(b.y-a.y)*(b.y-a.y),e=2*((b.x-a.x)*(a.x-this.pos.x)+(b.y-a.y)*(a.y-this.pos.y)),h=e*e-4*d*(this.pos.x*this.pos.x+this.pos.y*this.pos.y+a.x*a.x+a.y*a.y-2*(this.pos.x*a.x+this.pos.y*a.y)-this.radius*this.radius);if(0<h){var k=
Math.sqrt(h),h=(-e+k)/(2*d),d=(-e-k)/(2*d);if(!(0>h||1<h)||!(0>d||1<d))return!0}return!1}})();
(function(){function b(){this.Poly.apply(this,arguments)}iio.Poly=b;iio.inherit(b,iio.Shape);b.prototype._super=iio.Shape.prototype;b.prototype.Poly=function(a,b,d){"undefined"!=typeof a.x?(this._super.Shape.call(this,a),this.vertices=iio.getVecsFromPointList(b)):a instanceof Array?(this.vertices=iio.getVecsFromPointList(a),this.pos=new iio.Vec,this.styles={}):(this._super.Shape.call(this,a,b),this.vertices=iio.getVecsFromPointList(d));this.originToLeft=iio.getSpecVertex(this.vertices,function(a,
b){return a.x>b.x?!0:!1}).x;this.originToTop=iio.getSpecVertex(this.vertices,function(a,b){return a.y>b.y?!0:!1}).y;this.width=iio.getSpecVertex(this.vertices,function(a,b){return a.x<b.x?!0:!1}).x-this.originToLeft;this.height=iio.getSpecVertex(this.vertices,function(a,b){return a.y<b.y?!0:!1}).y-this.originToTop};b.prototype.clone=function(){return new b(this.pos,this.vertices)};b.prototype.left=function(){return iio.getSpecVertex(this.getTrueVertices(),function(a,b){return a.x>b.x?!0:!1}).x};b.prototype.right=
function(){return iio.getSpecVertex(this.getTrueVertices(),function(a,b){return a.x<b.x?!0:!1}).x};b.prototype.top=function(){return iio.getSpecVertex(this.getTrueVertices(),function(a,b){return a.y>b.y?!0:!1}).y};b.prototype.bottom=function(){return iio.getSpecVertex(this.getTrueVertices(),function(a,b){return a.y<b.y?!0:!1}).y};b.prototype.contains=function(a,b){b=a.y||b;a=a.x||a;var d=j=c=0,e=this.getTrueVertices(),d=0;for(j=e.length-1;d<e.length;j=d++)e[d].y>b!=e[j].y>b&&a<(e[j].x-e[d].x)*(b-
e[d].y)/(e[j].y-e[d].y)+e[d].x&&(c=!c);return c};b.prototype.getTrueVertices=function(){for(var a=[],b,d,e=0;e<this.vertices.length;e++)b=this.vertices[e].x,d=this.vertices[e].y,b=iio.rotatePoint(b,d,this.rotation),b.x+=this.pos.x,b.y+=this.pos.y,a[e]=b;return a}})();
(function(){function b(){this.Rect.apply(this,arguments)}iio.Rect=b;iio.inherit(b,iio.Poly);b.prototype._super=iio.Poly.prototype;b.prototype.Rect=function(a,b,d,e){"undefined"!=typeof a&&"undefined"!=typeof a.x?(e=d||b||0,d=b||0,b=a.y,a=a.x):(e=e||d||0,d=d||0,a=a||0,b=b||0);this._super.Poly.call(this,a,b,[-d/2,-e/2,d/2,-e/2,d/2,e/2,-d/2,e/2])};b.prototype.clone=function(){return new b(this.pos,this.width,this.height)};b.prototype.setSize=function(a,b){b=b||a.y||a||0;a=a.x||a||0;this.height=b;this.width=
a;this.originToLeft=-this.width/2;this.originToTop=-this.height/2;this.vertices=iio.getVecsFromPointList([-a/2,-b/2,a/2,-b/2,a/2,b/2,-a/2,b/2]);return this}})();(function(){function b(){this.XShape.apply(this,arguments)}iio.XShape=b;iio.inherit(b,iio.SimpleRect);b.prototype._super=iio.Rect.prototype;b.prototype.XShape=function(a,b,d,e){this._super.Rect.call(this,a,b,d,e)};b.prototype.clone=function(){return new b(this.pos,this.width,this.height)}})();
(function(){iio.Graphics={};iio.Graphics.transformContext=function(b,a,g){b.translate(a.x,a.y);"undefined"!=typeof g&&b.rotate(g)};iio.Graphics.applyContextStyles=function(b,a){"undefined"!=typeof a&&("undefined"!=typeof a.lineWidth&&(b.lineWidth=a.lineWidth),"undefined"!=typeof a.shadowColor&&(b.shadowColor=a.shadowColor),"undefined"!=typeof a.shadowBlur&&(b.shadowBlur=a.shadowBlur),b.globalAlpha=0===a.alpha?0:a.alpha||1,"undefined"!=typeof a.lineCap&&(b.lineCap=a.lineCap),"undefined"!=typeof a.shadowOffset&&
(b.shadowOffsetX=a.shadowOffset.x,b.shadowOffsetY=a.shadowOffset.y),"undefined"!=typeof a.fillStyle&&(b.fillStyle=a.fillStyle),"undefined"!=typeof a.strokeStyle&&(b.strokeStyle=a.strokeStyle))};iio.Graphics.prepStyledContext=function(b,a){b.save();"undefined"!=typeof a&&iio.Graphics.applyContextStyles(b,a);"undefined"!=typeof a&&"undefined"!=typeof a.shadow&&iio.Graphics.applyContextStyles(b,a.shadow);return b};iio.Graphics.prepTransformedContext=function(b,a,g,d){b=b||a.ctx;g=g||a.pos;d=d||a.rotation;
b.save();"undefined"!=typeof a.styles&&iio.Graphics.applyContextStyles(b,a.styles);iio.Graphics.transformContext(b,g,d);"undefined"!=typeof a.rAxis&&iio.Graphics.transformContext(b,a.rAxis);a.flipImg&&b.scale(-1,1);return b};iio.Graphics.finishPathShape=function(b,a,g,d,e,h){iio.Graphics.drawShadow(b,a);iio.Graphics.drawImage(b,a.img,!0)||(b.drawImage(a.img,g,d,e,h),b.restore());"undefined"!=typeof a.anims&&!iio.Graphics.drawImage(b,a.anims[a.animKey].srcs[a.animFrame])&&(b.drawImage(a.anims[a.animKey].srcs[a.animFrame],
g,d,e,h),b.restore());"undefined"!=typeof a.styles&&("undefined"!=typeof a.styles.fillStyle&&b.fill(),"undefined"!=typeof a.styles.strokeStyle&&b.stroke());b.restore()};iio.Graphics.drawLine=function(b,a,g,d,e){"undefined"!=typeof g.x&&(d=g.x,e=g.y);g=a.y||g;a=a.x||a;b.beginPath();b.moveTo(a,g);b.lineTo(d,e);b.stroke()};iio.Graphics.drawLine=function(b,a,g,d,e){"undefined"!=typeof g.x&&(d=g.x,e=g.y);g=a.y||g;a=a.x||a;b.beginPath();b.moveTo(a,g);b.lineTo(d,e);b.stroke()};iio.Graphics.drawDottedLine=
function(b,a,g,d,e,h){"undefined"!=typeof d.x&&(e=d.x,h=d.y);d=g.y||d;g=g.x||g;b.beginPath();b.dashedLine(g,d,e,h,a);b.stroke()};iio.Graphics.drawShadow=function(b,a){"undefined"==typeof a.styles||"undefined"==typeof a.styles.shadow||(b.save(),iio.Graphics.applyContextStyles(b,a.styles.shadow),"undefined"!=typeof a.styles.fillStyle||"undefined"!=typeof a.img||"undefined"!=typeof a.anims?b.fill():"undefined"!=typeof a.styles.strokeStyle&&b.stroke(),b.restore())};iio.Graphics.drawRectShadow=function(b,
a){"undefined"==typeof a.styles||"undefined"==typeof a.styles.shadow||(b.save(),iio.Graphics.applyContextStyles(b,a.styles.shadow),"undefined"!=typeof a.styles.rounding&&0!=typeof a.styles.rounding?iio.Graphics.drawRoundedRectPath(b,a):"undefined"!=typeof a.styles.fillStyle||"undefined"!=typeof a.img||"undefined"!=typeof a.anims?b.fillRect(-a.width/2,-a.height/2,a.width,a.height):"undefined"!=typeof a.styles.strokeStyle&&b.strokeRect(-a.width/2,-a.height/2,a.width,a.height),b.restore())};iio.Graphics.drawRoundedRectPath=
function(b,a){b.beginPath();b.moveTo(-a.width/2+a.styles.rounding,-a.height/2);b.lineTo(-a.width/2+a.width-a.styles.rounding,-a.height/2);b.quadraticCurveTo(-a.width/2+a.width,-a.height/2,-a.width/2+a.width,-a.height/2+a.styles.rounding);b.lineTo(-a.width/2+a.width,-a.height/2+a.height-a.styles.rounding);b.quadraticCurveTo(-a.width/2+a.width,-a.height/2+a.height,-a.width/2+a.width-a.styles.rounding,-a.height/2+a.height);b.lineTo(-a.width/2+a.styles.rounding,-a.height/2+a.height);b.quadraticCurveTo(-a.width/
2,-a.height/2+a.height,-a.width/2,-a.height/2+a.height-a.styles.rounding);b.lineTo(-a.width/2,-a.height/2+a.styles.rounding);b.quadraticCurveTo(-a.width/2,-a.height/2,-a.width/2+a.styles.rounding,-a.height/2);b.closePath();b.strokeStyle=a.styles.strokeStyle;b.stroke();b.fillStyle=a.styles.fillStyle;b.fill();b.clip()};iio.Graphics.drawImage=function(b,a,g){if("undefined"!=typeof a){b.save();if("undefined"!=typeof a.pos||"undefined"!=typeof a.rotation){var d=a.pos||new iio.Vec;iio.Graphics.transformContext(b,
d,a.rotation||0)}g&&b.clip();if("undefined"!=typeof a.size)b.drawImage(a,-a.size.x/2,-a.size.y/2,a.size.x,a.size.y);else if(a.nativeSize)b.drawImage(a,-a.width/2,-a.height/2,a.width,a.height);else if("undefined"!=typeof a.scale)b.drawImage(a,-a.width*a.scale/2,-a.height*a.scale/2,a.width*a.scale,a.height*a.scale);else return!1;b.restore()}return!0};iio.Graphics.drawSprite=function(b,a,g,d,e,h,k){"undefined"!=typeof d&&(b.save(),k&&b.clip(),h&&b.scale(-1,1),b.drawImage(d.src,d.frames[e].x,d.frames[e].y,
d.frames[e].w,d.frames[e].h,-a/2,-g/2,a,g),b.restore());return!0}})();
(function(){function b(){this.Grid.apply(this,arguments)}iio.Grid=b;iio.inherit(b,iio.Shape);b.prototype._super=iio.Obj.prototype;b.prototype.Grid=function(a,b,d,e,h,k){"undefined"!=typeof a.x?(this._super.Obj.call(this,a),k=h=e=d=b):this._super.Obj.call(this,a,b);this.set(a,b,d,e,h,k);this.resetCells()};b.prototype.clone=function(){return new b(this.pos.x,this.pos.y,this.endPos.x,this.endPos.y)};b.prototype.resetCells=function(){this.cells=Array(this.C);for(var a=0;a<this.cells.length;a++)this.cells[a]=
Array(this.R);for(a=0;a<this.cells[0].length;a++)for(var b=0;b<this.cells.length;b++)this.cells[b][a]={}};b.prototype.getCellCenter=function(a,b,d){return"undefined"!=typeof a.x?b?this.getCellCenter(this.getCellAt(a)):new iio.Vec(this.pos.x+a.x*this.res.x+this.res.x/2,this.pos.y+a.y*this.res.y+this.res.y/2):d?this.getCellCenter(this.getCellAt(a,b)):new iio.Vec(this.pos.x+a*this.res.x+this.res.x/2,this.pos.y+b*this.res.y+this.res.y/2)};b.prototype.getCellAt=function(a,b){var d=new iio.Vec(Math.floor((a.x-
this.pos.x)/this.res.x),Math.floor((a.y-this.pos.y)/this.res.y));return 0<=d.x&&d.x<this.C&&0<=d.y&&d.y<this.R?d:!1};b.prototype.set=function(a,b,d,e,h,k){"CANVAS"==d.tagName?(this.C=parseInt(d.width/e,10)+1,this.R=parseInt(d.height/(h||e),10)+1,this.res=new iio.Vec(e,h||e)):(this.R=e,this.C=d,this.res=new iio.Vec(h,k||h));this.setPos(a,b)};b.prototype.forEachCell=function(a){for(var b=!0,d=0;d<this.C;d++)for(var e=0;e<this.R;e++)if(b=a(this.cells[d][e],d,e),"undefined"!=typeof b&&!b)return[e,d]}})();
(function(){function b(){this.SpriteMap.apply(this,arguments)}function a(){this.Sprite.apply(this,arguments)}iio.SpriteMap=b;b.prototype.SpriteMap=function(a,b,e,h,k){h=h||b||function(){};this.sW=b!=h?b||0:0;this.sH=e||0;"undefined"!=typeof a.src?(this.srcImg=a,this.setSpriteRes(b,e)):(this.srcImg=iio.__newImage(),this.srcImg.src=a,this.srcImg.onload=function(){this.setSpriteRes(b,e);h(k)}.bind(this));return this};b.prototype.getSprite=function(a,b,e,h,k){var l=new iio.Sprite(this.srcImg);if("undefined"!=
typeof e)if(k)if(k=this.srcImg.width/a,"undefined"!=typeof h)for(;e<=h;e++)l.addFrame(e%k*a,parseInt(e/k,10)*b,a,b);else for(h=0;h<=this.C;h++)l.addFrame(h*a,e*b,a,b);else l.addFrame(a,b,e,h);else if("undefined"!=typeof b)for(e=a;e<=b;e++)l.addFrame(e%this.C*this.sW,parseInt(e/this.C,10)*this.sH,this.sW,this.sH);else for(h=0;h<=this.C;h++)l.addFrame(h*this.sW,a*this.sH,this.sW,this.sH);return l};b.prototype.setSpriteRes=function(a,b){this.sH=a.y||b;this.sW=a.x||a;this.C=this.srcImg.width/this.sW;
this.R=this.srcImg.height/this.sH};iio.Sprite=a;a.prototype.Sprite=function(a){this.src=a;this.frames=[];return this};a.prototype.addFrame=function(a,b,e,h){var k=this.frames.length;this.frames[k]={};this.frames[k].x=a;this.frames[k].y=b;this.frames[k].w=e;this.frames[k].h=h}})();
(function(){function b(a){this.styles.lineWidth=a;return this}function a(a,b){this.styles.strokeStyle=a;this.styles.lineWidth=b||this.styles.lineWidth;return this}function g(a){this.styles.alpha=a;return this}function d(a){this.styles.shadow.shadowColor=a;return this}function e(a){this.styles.shadow.shadowBlur=a;return this}function h(a,b){this.styles.shadow.shadowOffset=new iio.Vec(a,b||a);return this}function k(a){this.styles.fillStyle=a;return this}function l(a){this.styles.refLine=a||!0;return this}
function m(a,b,d,g){this.styles.shadow={};this.styles.shadow.shadowColor=a;"undefined"!=typeof b.x?(this.styles.shadow.shadowOffset=new iio.Vec(b),this.styles.shadow.shadowBlur=d):(this.styles.shadow.shadowOffset=new iio.Vec(b,d),this.styles.shadow.shadowBlur=g);return this}function n(a,b){this.img.pos=new iio.Vec(a,b||a);return this}function u(a){this.img.scale=a;return this}function r(a){this.img.rotation=a;return this}function v(a){this.flipImg="undefined"!=typeof a?a:"undefined"==typeof this.flipImg?
!0:!this.flipImg;"undefined"==typeof this.fsID&&this.clearDraw(this.ctx)}function B(a,b){"native"==a?this.img.nativeSize=!0:this.img.size=new iio.Vec(a,b||a);return this}function C(a,b){"undefined"!=typeof a.src?this.img=a:(this.img=iio.__newImage(),this.img.src=a,this.img.onload=b);return this}function D(a,b,d){"undefined"==typeof this.anims&&(this.anims=[]);"undefined"==typeof this.animKey&&(this.animKey=0);"undefined"==typeof this.animFrame&&(this.animFrame=0);var g=this.anims.length;if(a instanceof
iio.Sprite)return this.anims[g]=a,this.anims[g].tag=b,this;this.anims[g]={};this.anims[g].srcs=[];"function"==typeof b?d=b:this.anims[g].tag=b;for(b=0;b<a.length;b++)"undefined"!=typeof a[b].src?this.anims[g].srcs[b]=a[b]:(this.anims[g].srcs[b]=iio.__newImage(),this.anims[g].srcs[b].src=a[b]),b==this.animFrame&&"undefined"!=typeof d&&(this.anims[g].srcs[b].onload=d);return this}function E(a,b){"undefined"!=typeof a.src?(this.img=a,"undefined"!=typeof this.radius?this.radius=a.width/2:(this.width=
a.width,this.height=a.height)):(this.img=iio.__newImage(),this.img.src=a,this.img.onload=function(){"undefined"!=typeof this.radius?this.radius=this.img.width/2:(this.width=this.img.width||0,this.height=this.img.height||0);"undefined"!=typeof b&&b()}.bind(this));return this}function F(a){function b(a){"undefined"!=typeof a.onAnimComplete?a.onAnimComplete()&&(a.animFrame=0):a.animFrame=0}this.animFrame++;this.anims[this.animKey]instanceof iio.Sprite?this.animFrame>=this.anims[this.animKey].frames.length&&
b(this):this.animFrame>=this.anims[this.animKey].srcs.length&&b(this);a?this.clearDraw():this.redraw=!0;return this}function G(a){this.animFrame=a;return this}function H(a,b,d,g,e,h){iio.isNumber(a)?(h=e,e=g,g=d,d=b,b=a):(this.setAnimKey(a),iio.isNumber(g)&&(e=g));iio.isNumber(e)?this.onAnimComplete=h:(this.onAnimComplete=e,e=h||0);"undefined"!=typeof this.fsID&&this.stopAnim();g&&d.setFramerate(b,function(){this.nextAnimFrame()}.bind(this),this,d.ctxs[e||0]);d.setNoDrawFramerate(b,function(){this.nextAnimFrame()}.bind(this),
this,d.ctxs[e||0]);return this}function I(a,b,d,g,e,h){return this.playAnim(a,b,d,g,e,function(){this.stopAnim()}.bind(this))}function J(a,b){clearTimeout(this.fsID);this.fsID=void 0;this.setAnimKey(a);this.animFrame=0;"undefined"!=typeof b&&(this.clearDraw(b),this.draw(b));return this}function K(a){if(iio.isNumber(a))this.animKey=a;else for(var b=0;b<this.anims.length;b++)this.anims[b].tag==a&&(this.animKey=b);return this}function y(a,b){"undefined"==typeof this.update&&this.enableUpdates();this.fxFade=
{};this.fxFade.rate=a;this.fxFade.alpha=b;return this}function z(a,b){return this.fade(a,b||1)}function A(a,b){return this.fade(-a,b||0)}function L(a){this.polyDraw=a;return this}function M(a,b,d){if("undefined"==typeof a)return this;a=iio.Graphics.prepTransformedContext(a,this,b,d);a.beginPath();a.arc(0,0,this.radius,0,2*Math.PI,!1);iio.Graphics.drawShadow(a,this);if(!iio.Graphics.drawImage(a,this.img,this.polyDraw?!1:!0))a.drawImage(this.img,-this.radius,-this.radius,2*this.radius,2*this.radius),
a.restore();"undefined"!=typeof this.anims&&!iio.Graphics.drawImage(a,this.anims[this.animKey].srcs[this.animFrame])&&(a.drawImage(this.anims[this.animKey].srcs[this.animFrame],-this.radius,-this.radius,2*this.radius,2*this.radius),a.restore());"undefined"!=typeof this.styles&&("undefined"!=typeof this.styles.fillStyle&&a.fill(),"undefined"!=typeof this.styles.strokeStyle&&a.stroke(),this.styles.refLine&&iio.Graphics.drawLine(a,0,0,this.radius,0));a.restore();return this}function t(a,b,d,g,e,h){a.save();
iio.Graphics.transformContext(a,b.pos,b.rotation);"undefined"!=typeof b.rAxis&&iio.Graphics.transformContext(a,b.rAxis);var k=new iio.Vec(2,2);if("undefined"!=typeof b.styles&&("undefined"!=typeof b.styles.lineWidth?k.add(b.styles.lineWidth,b.styles.lineWidth):"undefined"!=typeof b.styles.strokeStyle&&k.add(2,2),"undefined"!=typeof b.styles.shadow&&"undefined"!=typeof b.styles.shadow.shadowOffset))return e="undefined"!=typeof e?new iio.Vec(e-k.x,h-k.y):new iio.Vec(-d/2-k.x,-g/2-k.y),e.add(-Math.abs(b.styles.shadow.shadowOffset.x)-
8,-Math.abs(b.styles.shadow.shadowOffset.y)-8),k.add(2*Math.abs(b.styles.shadow.shadowOffset.x)+16,2*Math.abs(b.styles.shadow.shadowOffset.y)+16),a.clearRect(e.x,e.y,d+k.x,g+k.y),a.restore(),b;a.clearRect(-d/2-k.x/2,-g/2-k.y/2,d+k.x,g+k.y);a.restore();return b}iio.Obj.prototype.setLineWidth=b;iio.Obj.prototype.setStrokeStyle=a;iio.Obj.prototype.setShadowColor=d;iio.Obj.prototype.setShadowBlur=e;iio.Obj.prototype.setShadowOffset=h;iio.Obj.prototype.setShadow=m;iio.Obj.prototype.setAlpha=g;iio.Text.prototype.setFillStyle=
k;iio.Shape.prototype.setFillStyle=k;iio.Circle.prototype.drawReferenceLine=l;iio.Line.prototype.setLineCap=function(a){this.styles.lineCap=a;return this};iio.SimpleRect.prototype.setRoundingRadius=iio.Rect.prototype.setRoundingRadius=function(a){this.styles.rounding=a;return this};iio.Obj.prototype.fadeIn=z;iio.Obj.prototype.fadeOut=A;iio.Obj.prototype.fade=y;iio.Shape.prototype.setImgOffset=n;iio.Shape.prototype.setImgScale=u;iio.Shape.prototype.setImgRotation=r;iio.Shape.prototype.setImgSize=B;
iio.Shape.prototype.flipImage=v;iio.Shape.prototype.addImage=C;iio.Shape.prototype.addAnim=D;iio.Rect.prototype.createWithImage=iio.SimpleRect.prototype.createWithImage=E;iio.Circle.prototype.createWithImage=E;iio.Rect.prototype.createWithAnim=iio.SimpleRect.prototype.createWithAnim=function(a,b,d,g){"undefined"==typeof g&&iio.isNumber(d)&&(g=d);g=g||0;"function"==typeof b?(d=b,this.addAnim(a)):this.addAnim(a,b);if(a instanceof iio.Sprite)return this.width=a.frames[g].w,this.height=a.frames[g].h,
this.animKey=0,this.animFrame=g||0,this;"undefined"!=typeof a[0].src?(this.width=a[g].width,this.height=a[g].height):(this.animKey=0,this.animFrame=g,this.anims[0].srcs[g].onload=function(){this.width=this.anims[0].srcs[g].width||0;this.height=this.anims[0].srcs[g].height||0;"undefined"!=typeof d&&!iio.isNumber(d)&&d()}.bind(this));return this};iio.Shape.prototype.nextAnimFrame=F;iio.Shape.prototype.setAnimFrame=G;iio.Shape.prototype.setAnimKey=K;iio.Shape.prototype.playAnim=H;iio.Shape.prototype.play1Anim=
I;iio.Shape.prototype.stopAnim=J;iio.Shape.prototype.setAnim=function(a,b,d,g){"undefined"!=typeof this.fsID&&(clearTimeout(this.fsID),this.fsID=void 0);if(iio.isNumber(b))g=d=b,b=function(){};else if(b instanceof Array){b=b[0];var e=b[1]}else b=function(){};"undefined"!=typeof d&&(iio.isNumber(d)||(g=g||d));this.animFrame=d||0;this.setAnimKey(a);"undefined"!=typeof g&&(this.clearDraw(g),this.draw(g));"undefined"!=e?b(e):b();return this};iio.Shape.prototype.clearDraw=function(a){a=a||this.ctx;this.redraw=
!0;"undefined"!=typeof this.clearSelf&&"undefined"!=typeof a&&this.clearSelf(a);return this};iio.Text.prototype.clearDraw=iio.Shape.prototype.clearDraw;iio.Line.prototype.draw=function(a){a=a||this.ctx;iio.Graphics.prepStyledContext(a,this.styles);this.dashed?iio.Graphics.drawDottedLine(a,this.dashProperties,this.pos,this.endPos):iio.Graphics.drawLine(a,this.pos,this.endPos);a.restore();return this};iio.MultiLine.prototype.draw=function(a){a=a||this.ctx;iio.Graphics.prepStyledContext(a,this.styles);
for(var b=1;b<this.vertices.length;b++)iio.Graphics.drawLine(a,this.vertices[b-1],this.vertices[b]);a.restore();return this};iio.Grid.prototype.draw=function(a){a=a||this.ctx;iio.Graphics.prepStyledContext(a,this.styles);iio.Graphics.drawImage(a,this.img)||(a.drawImage(this.img,this.pos.x,this.pos.y,this.res.x*this.C,this.res.y*this.R),a.restore());for(var b=1;b<this.R;b++)iio.Graphics.drawLine(a,this.pos.x,this.pos.y+b*this.res.y,this.pos.x+this.C*this.res.x,this.pos.y+b*this.res.y);for(b=1;b<this.C;b++)iio.Graphics.drawLine(a,
this.pos.x+b*this.res.x,this.pos.y,this.pos.x+b*this.res.x,this.pos.y+this.R*this.res.y);a.restore();return this};iio.XShape.prototype.draw=function(a){a=a||this.ctx;iio.Graphics.prepStyledContext(a,this.styles);iio.Graphics.drawLine(a,iio.Vec.sub(this.pos,this.width/2,this.height/2),iio.Vec.add(this.pos,this.width/2,this.height/2));iio.Graphics.drawLine(a,iio.Vec.add(this.pos,this.width/2,-this.height/2),iio.Vec.add(this.pos,-this.width/2,this.height/2));a.restore();return this};iio.Text.prototype.top=
function(){return this.pos.y};iio.Text.prototype.bottom=function(){return this.pos.y+parseInt(this.font,10)};iio.Text.prototype.right=function(){var a;this.ctx.save();this.ctx.font=this.font;a="center"==this.textAlign?this.pos.x+this.ctx.measureText(this.text).width/2:"right"==this.textAlign||"end"==this.textAlign?this.pos.x:this.pos.x+this.ctx.measureText(this.text).width;this.ctx.restore();return a};iio.Text.prototype.left=function(){var a;this.ctx.save();this.ctx.font=this.font;a="center"==this.textAlign?
this.pos.x-this.ctx.measureText(this.text).width/2:"right"==this.textAlign||"end"==this.textAlign?this.pos.x-this.ctx.measureText(this.text).width:this.pos.x;this.ctx.restore();return a};iio.Text.prototype.clearSelf=function(a){this.ctx=a||this.ctx;this.ctx.font=this.font;a=parseInt(this.font,10);var b=this.ctx.measureText(this.text);return"center"==this.textAlign?t(this.ctx,this,b.width,a,-b.width/2,-a/2):"right"==this.textAlign||"end"==this.textAlign?t(this.ctx,this,b.width,a,-b.width,-a/2):t(this.ctx,
this,b.width,a,0,-a/2)};iio.Text.prototype.draw=function(a){if("undefined"==typeof a)return this;this.ctx=a||this.ctx;iio.Graphics.prepStyledContext(this.ctx,this.styles);iio.Graphics.transformContext(this.ctx,this.pos,this.rotation);this.ctx.font=this.font;this.ctx.textAlign=this.textAlign;if("undefined"==typeof this.wrap||0>=this.wrap)"undefined"!=typeof this.styles.fillStyle&&this.ctx.fillText(this.text,0,0),"undefined"!=typeof this.styles.strokeStyle&&this.ctx.strokeText(this.text,0,0);else{a=
this.lineheight||28;for(var b=this.text.split(" "),d="",g=0,e=0;e<b.length;e++){var h=d+b[e]+" ";this.ctx.measureText(h).width>this.wrap?(this.ctx.fillText(d,0,g),d=b[e]+" ",g+=a):d=h}this.ctx.fillText(d,0,g)}this.ctx.restore();return this};iio.Circle.prototype.draw=M;iio.Circle.prototype.setPolyDraw=L;iio.Poly.prototype.draw=function(a){if("undefined"==typeof a)return this;a=iio.Graphics.prepTransformedContext(a,this);a.beginPath();a.moveTo(this.vertices[0].x,this.vertices[0].y);for(var b=1;b<this.vertices.length;b++)a.lineTo(this.vertices[b].x,
this.vertices[b].y);a.closePath();iio.Graphics.finishPathShape(a,this,this.originToLeft,this.originToTop,this.width,this.height)};iio.Rect.prototype.draw=iio.SimpleRect.prototype.draw=function(a,b,d){if("undefined"==typeof a)return this;a=iio.Graphics.prepTransformedContext(a,this,b,d);iio.Graphics.drawRectShadow(a,this);"undefined"!=typeof this.styles&&("undefined"!=typeof this.styles.rounding&&0!=this.styles.rounding)&&iio.Graphics.drawRoundedRectPath(a,this);iio.Graphics.drawImage(a,this.img)||
(a.drawImage(this.img,-this.width/2,-this.height/2,this.width,this.height),a.restore());"undefined"!=typeof this.anims&&(this.anims[this.animKey]instanceof iio.Sprite?iio.Graphics.drawSprite(a,this.width,this.height,this.anims[this.animKey],this.animFrame):iio.Graphics.drawImage(a,this.anims[this.animKey].srcs[this.animFrame])||(a.drawImage(this.anims[this.animKey].srcs[this.animFrame],-this.width/2,-this.height/2,this.width,this.height),a.restore()));"undefined"!=typeof this.styles&&("undefined"!=
typeof this.styles.fillStyle&&a.fillRect(-this.width/2,-this.height/2,this.width,this.height),"undefined"!=typeof this.styles.strokeStyle&&a.strokeRect(-this.width/2,-this.height/2,this.width,this.height));a.restore();return this};iio.Rect.prototype.clearSelf=iio.SimpleRect.prototype.clearSelf=function(a){return t(a,this,this.width,this.height)};iio.Circle.prototype.clearSelf=function(a){return t(a,this,2*this.radius,2*this.radius)};iio.Poly.prototype.clearSelf=function(a){return t(a,this,this.width,
this.height,this.originToLeft,this.originToTop)};if("undefined"!=typeof Box2D){var p=Box2D.Collision.Shapes.b2Shape,w=Box2D.Collision.Shapes.b2CircleShape,q=Box2D.Dynamics.Joints.b2Joint;Box2D.Collision.Shapes.b2PolygonShape.prototype.prepGraphics=function(a){this.originToLeft=iio.getSpecVertex(this.m_vertices,function(a,b){return a.x>b.x?!0:!1}).x*a;this.originToTop=iio.getSpecVertex(this.m_vertices,function(a,b){return a.y>b.y?!0:!1}).y*a;this.width=iio.getSpecVertex(this.m_vertices,function(a,
b){return a.x<b.x?!0:!1}).x*a-this.originToLeft;this.height=iio.getSpecVertex(this.m_vertices,function(a,b){return a.y<b.y?!0:!1}).y*a-this.originToTop;this.styles={};return this};w.prototype.prepGraphics=function(a){this.radius=this.m_radius*a;this.styles={};return this};var N=function(){this.styles={};return this};q.prototype.prepGraphics=N;p.prototype.prepGraphics=N;p.prototype.setAlpha=g;q.prototype.setAlpha=g;q.prototype.setLineWidth=b;p.prototype.setLineWidth=b;q.prototype.setStrokeStyle=a;
p.prototype.setStrokeStyle=a;q.prototype.setShadowColor=d;p.prototype.setShadowColor=d;q.prototype.setShadowBlur=e;p.prototype.setShadowBlur=e;q.prototype.setShadowOffset=h;p.prototype.setShadowOffset=h;q.prototype.setShadow=m;p.prototype.setShadow=m;p.prototype.setFillStyle=k;w.prototype.drawReferenceLine=l;p.prototype.fadeIn=z;p.prototype.fadeOut=A;p.prototype.fade=y;q.prototype.fadeIn=z;q.prototype.fadeOut=A;q.prototype.fade=y;p.prototype.setImgOffset=n;p.prototype.setImgScale=u;p.prototype.setImgRotation=
r;p.prototype.setImgSize=B;p.prototype.addImage=C;p.prototype.flipImage=v;p.prototype.addAnim=D;p.prototype.nextAnimFrame=F;p.prototype.setAnimFrame=G;p.prototype.setAnimKey=K;p.prototype.playAnim=H;p.prototype.play1Anim=I;p.prototype.stopAnim=J;w.prototype.draw=M;w.prototype.setPolyDraw=L;Box2D.Collision.Shapes.b2PolygonShape.prototype.draw=function(a,b,d,g){a=iio.Graphics.prepTransformedContext(a,this,b,d);a.beginPath();a.moveTo(this.m_vertices[0].x*g,this.m_vertices[0].y*g);for(b=1;b<this.m_vertices.length;b++)a.lineTo(this.m_vertices[b].x*
g,this.m_vertices[b].y*g);a.closePath();iio.Graphics.finishPathShape(a,this,this.originToLeft,this.originToTop,this.width,this.height)};Box2D.Dynamics.b2Body.draw=function(a,b){for(f=this.objs[i].GetFixtureList();f;f=f.m_next)s=f.GetShape(),"undefined"!=typeof s.draw&&s.draw(a,new iio.Vec(this.objs[i].m_xf.position.x*b,this.objs[i].m_xf.position.y*b),this.objs[i].GetAngle(),b)};Box2D.Dynamics.Joints.b2Joint.prototype.draw=function(a,b){var d=this.GetBodyA(),g=this.GetBodyB(),e=d.m_xf.position,h=g.m_xf.position,
k=this.GetAnchorA(),n=this.GetAnchorB();iio.Graphics.prepStyledContext(a,this.styles);switch(this.m_type){case Box2D.Dynamics.Joints.b2Joint.e_distanceJoint:iio.Graphics.drawLine(a,k.x*b,k.y*b,n.x*b,n.y*b);break;case Box2D.Dynamics.Joints.b2Joint.e_pulleyJoint:g=this instanceof b2PulleyJoint?this:null;d=g.GetGroundAnchorA();g=g.GetGroundAnchorB();iio.Graphics.drawLine(a,d.x*b,d.y*b,k.x*b,k.y*b);iio.Graphics.drawLine(a,g.x*b,g.y*b,n.x*b,n.y*b);iio.Graphics.drawLine(a,d.x*b,d.y*b,g.x*b,g.y*b);break;
case Box2D.Dynamics.Joints.b2Joint.e_mouseJoint:iio.Graphics.drawLine(a,k.x*b,k.y*b,n.x*b,n.y*b);break;default:d!=this.m_groundBody&&iio.Graphics.drawLine(a,e.x*b,e.y*b,k.x*b,k.y*b),iio.Graphics.drawLine(a,k.x*b,k.y*b,n.x*b,n.y*b),g!=this.m_groundBody&&iio.Graphics.drawLine(a,h.x*b,h.y*b,n.x*b,n.y*b)}}}})();
(function(){function b(a,b){("undefined"!=typeof a.acc&&0<a.acc.length()||"undefined"!=typeof a.vel&&0<a.vel.length()||"undefined"!=typeof a.torque&&0<a.torque)&&a.clearDraw();"undefined"!=typeof a.acc&&("undefined"==typeof a.vel&&a.setVel(),a.vel.add(a.acc));"undefined"!=typeof a.vel&&a.translate(new iio.Vec(a.vel.x,a.vel.y));"undefined"!=typeof a.torque&&(a.rotation+=a.torque,a.rotation>2*Math.PI?a.rotation-=2*Math.PI:a.rotation<-2*Math.PI&&(a.rotation+=2*Math.PI));if(0<a.shrinkRate)if("undefined"!=
typeof a.radius){if(a.setRadius(a.radius*(1-a.shrinkRate)),Math.abs(0.1>a.radius))return!1}else if(a.setSize(a.width*(1-a.shrinkRate),a.height*(1-a.shrinkRate)),Math.abs(0.1>a.width)&&Math.abs(0.1>a.height))return!1;if(null!=a.bounds){var d=a.top()||a.pos.y-a.radius||0;if("undefined"!=typeof a.bounds.top&&d<a.bounds.top.val)return"undefined"!=typeof a.bounds.top.callback?a.bounds.top.callback(a)||!1:!1;d=a.right()||a.pos.x+a.radius||0;if("undefined"!=typeof a.bounds.right&&d>a.bounds.right.val)return"undefined"!=
typeof a.bounds.right.callback?a.bounds.right.callback(a)||!1:!1;d=a.bottom()||a.pos.y+a.radius||0;if("undefined"!=typeof a.bounds.bottom&&d>a.bounds.bottom.val)return"undefined"!=typeof a.bounds.bottom.callback?a.bounds.bottom.callback(a)||!1:!1;d=a.left()||a.pos.x-a.radius||0;if("undefined"!=typeof a.bounds.left&&d<a.bounds.left.val)return"undefined"!=typeof a.bounds.left.callback?a.bounds.left.callback(a)||!1:!1}return!0}function a(a,b){this.vel=new iio.Vec(a,b);return this}function g(a,b){this.acc=
new iio.Vec(a,b);return this}function d(a){this.torque=a;"undefined"==typeof this.rotation&&(this.rotation=0);return this}function e(a,b,d){"undefined"==typeof this.bounds&&(this.bounds={});"top"==a?(this.bounds.top={},this.bounds.top.val=b,this.bounds.top.callback=d):"right"==a?(this.bounds.right={},this.bounds.right.val=b,this.bounds.right.callback=d):"bottom"==a?(this.bounds.bottom={},this.bounds.bottom.val=b,this.bounds.bottom.callback=d):"left"==a&&(this.bounds.left={},this.bounds.left.val=b,
this.bounds.left.callback=d);return this}function h(a,b,d,g,e){this.bounds={};"undefined"!=typeof a&&(this.bounds.top={},this.bounds.top.val=a,this.bounds.top.callback=e);"undefined"!=typeof b&&(this.bounds.right={},this.bounds.right.val=b,this.bounds.right.callback=e);"undefined"!=typeof d&&(this.bounds.bottom={},this.bounds.bottom.val=d,this.bounds.bottom.callback=e);"undefined"!=typeof g&&(this.bounds.left={},this.bounds.left.val=g,this.bounds.left.callback=e);return this}function k(a){this.shrinkRate=
a;return this}function l(){this.vel=this.acc=this.torque=this.bounds=void 0}function m(){this.enableUpdates(b);this.setVel=a;this.setAcc=g;this.setTorque=d;this.setBounds=h;this.setBound=e;this.shrink=k;this.stopKinematics=l;return this}iio.Shape.prototype.enableKinematics=m;iio.Text.prototype.enableKinematics=m})();(function(){function b(){this.CollisionTag.apply(this,arguments)}iio.CollisionTag=b;b.prototype.CollisionTag=function(a,b){this.tag=a;this.callback=b}})();
(function(){function b(){this.Group.apply(this,arguments)}iio.Group=b;b.prototype.Group=function(a,b){this.tag=a;this.zIndex=b;this.objs=[]};b.prototype.addObj=function(a){this.objs[this.objs.length]=a};b.prototype.rmvObj=function(a){for(var b=0;b<this.objs.length;b++)if(a==this.objs[b])return this.objs.splice(b,1),"undefined"!=typeof a.m_I?a.GetWorld().DestroyBody(a):!0;return!1};b.prototype.rmvAll=function(){this.objs=[];return!0};b.prototype.addCollisionCallback=function(a,b){"undefined"==typeof this.collisionTags&&
(this.collisionTags=[]);this.collisionTags[this.collisionTags.length]=new iio.CollisionTag(a,b)};b.prototype.update=function(a){for(var b=this.objs.length-1;0<=b;b--)"undefined"!=typeof this.objs[b]&&("undefined"!=typeof this.objs[b].update&&!this.objs[b].update(a)?this.objs.splice(b,1):this.objs[b].redraw&&(this.redraw=!0))};b.prototype.draw=function(a,b){for(var d=0;d<this.objs.length;d++)if("undefined"!==typeof this.objs[d].pos)this.objs[d].draw(a);else if("undefined"!==typeof this.objs[d].m_I)for(f=
this.objs[d].GetFixtureList();f;f=f.m_next)s=f.GetShape(),"undefined"!=typeof s.draw&&s.draw(a,new iio.Vec(this.objs[d].m_xf.position.x*b,this.objs[d].m_xf.position.y*b),this.objs[d].GetAngle(),b);else"undefined"!==typeof this.objs[d].m_edgeA&&this.objs[d].draw(a,b)}})();
(function(){function b(){this.AppManager.apply(this,arguments)}iio.AppManager=b;b.prototype.AppManager=function(a,b,d,e){this.cnvs=[];this.ctxs=[];if("undefined"==typeof a)throw Error("iio.start: No app provided");if("undefined"==typeof d&&iio.isString(b))this.addCanvas(b);else{if(iio.isString(b))if("auto"==b)e=d||"auto",d=b,b="body";else{if(d=d||"auto",e=e||"auto","body"!=b&&!document.getElementById(b))throw Error("iio.start: Invalid element id");}else e=d||"auto",d=b||"auto";this.addCanvas(0,d,
e,b)}this.canvas=this.cnvs[0];this.context=this.ctxs[0];this.app=new a(this);this.addWindowListeners()};b.prototype.setFramerate=function(a,b,d,e){if("undefined"!=typeof b&&"undefined"!=typeof b.draw){if("undefined"!=typeof e)var h=e;e=d||this.ctxs[0];d=b;b=h||function(){};d.ctx=e}else d=d||0;iio.isNumber(d)&&(d=this.cnvs[d]);"undefined"==typeof d.lastTime&&(d.lastTime=0);"undefined"!=typeof e&&(d.ctx=e);iio.requestTimeout(a,d.lastTime,function(b,d){if(d[1].pause)d[1].setFramerate(a,d[2],d[0]);else{d[0].lastTime=
b;d[1].setFramerate(a,d[2],d[0]);"undefined"!=typeof d[0].update&&d[0].update(b);if("undefined"!=typeof d[2])d[2](b);d[0].redraw&&(d[0].draw(),d[0].redraw=!1)}},[d,this,b]);return this};b.prototype.setNoDrawFramerate=function(a,b,d,e){if("undefined"!=typeof b&&"undefined"!=typeof b.draw){if("undefined"!=typeof e)var h=e;e=d||this.ctxs[0];d=b;b=h||function(){};d.ctx=e}else d=d||0;iio.isNumber(d)&&(d=this.cnvs[d]);"undefined"==typeof d.lastTime&&(d.lastTime=0);"undefined"!=typeof e&&(d.ctx=e);iio.requestTimeout(a,
d.lastTime,function(b,d){if(d[1].pause)d[1].setNoDrawFramerate(a,d[2],d[0]);else if(d[0].lastTime=b,d[1].setNoDrawFramerate(a,d[2],d[0]),"undefined"!=typeof d[0].update&&d[0].update(b),"undefined"!=typeof d[2])d[2](b)},[d,this,b]);return this};b.prototype.pauseFramerate=function(a,b){var d=b||this;d.pause="undefined"==typeof a?"undefined"==typeof d.pause?!0:!d.pause:a;return d};b.prototype.cancelFramerate=function(a){if(a instanceof iio.Obj)return clearTimeout(a.fsID),a;clearTimeout(this.cnvs[a||
0].fsID)};b.prototype.setCursorStyle=function(a,b){this.cnvs[b||0].style.cursor=a||"default";return this};b.prototype.setAnimFPS=function(a,b,d){d=d||0;b instanceof Array?this.setFramerate(a,function(){for(var a=0;a<b.length;a++)b[a].nextAnimFrame()},b,this.ctxs[d]):this.setFramerate(a,function(){b.nextAnimFrame()},b,this.ctxs[d]);return this};b.prototype.setB2Framerate=function(a,b){"undefined"==typeof this.b2lastTime&&(this.b2lastTime=0);"undefined"!=typeof this.b2World&&!this.b2Pause&&this.b2World.Step(1/
this.fps,10,10);iio.requestTimeout(a,this.b2lastTime,function(d,e){e[0].b2lastTime=d;e[0].setB2Framerate(a,b);"undefined"!=typeof e[0].b2World&&!e[0].b2Pause&&e[0].b2World.Step(1/a,10,10);b(d);"undefined"!=typeof e[0].b2DebugDraw&&e[0].b2DebugDraw?e[0].b2World.DrawDebugData():e[0].draw(e[0].b2Cnv);"undefined"!=typeof this.b2World&&e[0].b2World.ClearForces()},[this]);return this};b.prototype.pauseB2World=function(a){this.b2Pause="undefined"==typeof a?"undefined"==typeof this.b2Pause?!0:!this.b2Pause:
a};b.prototype.addB2World=function(a,b){this.b2World=a;this.b2Scale=30;this.b2Cnv=b||0;return a};b.prototype.update=function(a){for(var b=0;b<this.cnvs.length;b++)this.cnvs[b].update(a)};b.prototype.draw=function(a){if("undefined"==typeof a)for(a=0;a<this.cnvs.length;a++)this.cnvs[a].draw(this.b2Scale);else this.cnvs[a].draw(this.b2Scale);return this};b.prototype.addCanvas=function(a,b,d,e,h){var k=this.cnvs.length;if(iio.isString(a)){if(!document.getElementById(a))throw Error("AppManager.addCanvas: Invalid canvas id '"+
a+"'");this.cnvs[k]=document.getElementById(a);this.ctxs[k]=this.cnvs[k].getContext("2d");if("undefined"==typeof this.cnvs[k].getContext)throw Error("AppManager.addCanvas: given id did not correspond to a canvas object");this.setCanvasProperties(k);this.setCanvasFunctions(k);this.addFocusListeners(k);return k}"auto"==b&&(b=window.innerWidth);"auto"==d&&(d=window.innerHeight);this.cnvs[k]=iio.__newCanvas(function(a){});this.cnvs[k].width=b||this.cnvs[0].width;this.cnvs[k].height=d||this.cnvs[0].height;
this.cnvs[k].style.zIndex=a||-k;iio.isString(e)?"body"==e?document.body.appendChild(this.cnvs[k]):document.getElementById(e).appendChild(this.cnvs[k]):1<this.cnvs.length?(this.cnvs[k].style.position="absolute",a=this.getCanvasOffset(),this.cnvs[k].style.left=a.x+"px",this.cnvs[k].style.top=a.y+"px",this.cnvs[k].style.margin=0,this.cnvs[k].style.padding=0,this.cnvs[0].parentNode.appendChild(this.cnvs[k])):document.body.appendChild(this.cnvs[k]);this.cnvs[k].className+="ioCanvas";if(e instanceof Array)for(a=
0;a<e.length;a++)this.cnvs[k].className+=" "+e[a];if(h instanceof Array)for(a=0;a<h.length;a++)this.cnvs[k].className+=" "+h[a];else iio.isString(h)&&(this.cnvs[k].className+=" "+h);this.cnvs[k].width==window.innerWidth&&this.cnvs[k].height==window.innerHeight&&(this.cnvs[k].style.display="block",this.cnvs[k].style.position="absolute",this.cnvs[k].style.top=0,document.body.style.overflow="hidden");this.cnvs[k].width==window.innerWidth&&(document.body.style.marginLeft=document.body.style.marginRight=
document.body.style.paddingLeft=document.body.style.paddingRight="0",this.fullWidth=!0);this.cnvs[k].height==window.innerHeight&&(document.body.style.marginTop=document.body.style.marginBottom=document.body.style.paddingTop=document.body.style.paddingBottom="0",this.fullHeight=!0);this.ctxs[k]=this.cnvs[k].getContext("2d");this.setCanvasProperties(k);this.setCanvasFunctions(k);this.addFocusListeners(k);return k};b.prototype.disableContextMenu=function(a){this.cnvs[a||0].oncontextmenu=function(){return!1}};
b.prototype.disableStaticCollisionChecks=function(a){this.cnvs[a||0].disableStaticCollisions=!0;return this};b.prototype.setOnContextMenu=function(a,b){this.cnvs[b||0].oncontextmenu=a};b.prototype.setCanvasFunctions=function(a){this.ctxs[a].webkitImageSmoothingEnabled=!0;this.cnvs[a].draw=function(a){this.getContext("2d").clearRect(0,0,this.width,this.height);if("undefined"!=typeof this.groups)for(var b=0;b<this.groups.length;b++)this.groups[b].draw(this.getContext("2d"),a)};this.cnvs[a].update=function(a){if("undefined"!=
typeof this.groups)for(var b=this.groups.length-1;0<=b;b--){this.groups[b].update(a);for(var e=0;"undefined"!=typeof this.groups[b].collisionTags&&e<this.groups[b].collisionTags.length;)this.checkCollisions(this.groups[b],this.groups[this.indexOfTag(this.groups[b].collisionTags[e].tag)],this.groups[b].collisionTags[e].callback),e++;this.groups[b].redraw&&(this.redraw=!0)}};this.cnvs[a].indexOfTag=function(a){if("undefined"!=typeof this.groups)for(var b=0;b<this.groups.length;b++)if(this.groups[b].tag==
a)return b;return"NO"};this.cnvs[a].checkCollisions=function(a,b,e){if(a==b)var h=[],k,l;for(var m=0;m<a.objs.length;m++)for(var n=0;n<b.objs.length;n++)if("undefined"!=typeof a.objs[m]&&a.objs[m]!=b.objs[n]&&!("undefined"!=typeof this.disableStaticCollisions&&this.disableStaticCollisions&&"undefined"==typeof a.objs[m].vel&&"undefined"==typeof b.objs[n].vel&&(!("undefined"!=typeof a.objs[m].vel&&0!=a.objs[m].vel.length())||!("undefined"!=typeof b.objs[n].vel&&0!=b.objs[n].vel.length())))&&iio.intersects(a.objs[m],
b.objs[n]))if(h instanceof Array){k=!1;for(l=0;l<h.length;l++)if(m==h[l][0]&&n==h[l][1]||m==h[l][1]&&n==h[l][0])k=!0;k||(k=h.length,h[k]=[],h[k][0]=m,h[k][1]=n,e(a.objs[m],b.objs[n]))}else e(a.objs[m],b.objs[n])}};b.prototype.setCanvasProperties=function(a){this.cnvs[a].pos=this.getCanvasOffset(a);this.cnvs[a].center=new iio.Vec(this.cnvs[a].width/2,this.cnvs[a].height/2)};b.prototype.addFocusListeners=function(a){this.focused=!1;this.cnvs[a].addEventListener("mouseover",function(b){this[0].focused=
!0;"undefined"!=typeof this[0].app.focusOn&&this[0].app.focusOn(b,a)}.bind([this,a]),!1);this.cnvs[a].addEventListener("mouseout",function(b){this[0].focused=!1;"undefined"!=typeof this[0].app.focusOff&&this[0].app.focusOff(b,a)}.bind([this,a]),!1)};b.prototype.addWindowListeners=function(){iio.addEvent(window,"resize",function(a){this.fullWidth&&(this.canvas.width=window.innerWidth);this.fullHeight&&(this.canvas.height=window.innerHeight);for(var b=0;b<this.cnvs.length;b++)this.setCanvasProperties(b),
0<b&&(this.cnvs[b].style.left=this.cnvs[0].offsetLeft+"px",this.cnvs[b].style.top=this.cnvs[0].offsetTop+"px");if("undefined"!=typeof this.app.onResize)this.app.onResize(a)}.bind(this),!1);iio.addEvent(window,"scroll",function(a){for(var b=0;b<this.cnvs.length;b++)this.setCanvasProperties(b);if("undefined"!=typeof this.app.onScroll)this.app.onScroll(a)}.bind(this),!1)};b.prototype.drawPartialPixels=function(a){this.partialPixels=!0;return this};b.prototype.activateB2Debugger=function(a,b){b=b||0;
this.b2DebugDraw=new Box2D.Dynamics.b2DebugDraw;this.b2DebugDraw.SetSprite(this.ctxs[b]);this.b2DebugDraw.SetDrawScale(this.b2Scale);this.b2DebugDraw.SetFillAlpha(0.5);this.b2DebugDraw.SetLineThickness(1);this.b2DebugDraw.SetFlags(Box2D.Dynamics.b2DebugDraw.e_shapeBit|Box2D.Dynamics.b2DebugDraw.e_jointBit);this.b2World.SetDebugDraw(this.b2DebugDraw);return this.b2DebugDraw};b.prototype.playSound=function(a){("undefined"==typeof this.muted||!this.muted)&&iio.playSound(a);return this};b.prototype.mute=
function(a){"undefined"==typeof this.muted&&(this.muted=!0);"undefined"!=typeof a&&(this.muted=a);return this};b.prototype.addGroup=function(a,b,d){d=d||0;"undefined"==typeof this.cnvs[d].groups&&(this.cnvs[d].groups=[]);b=b||0;var e=this.indexFromzIndexInsertSort(b,this.cnvs[d].groups);this.cnvs[d].groups.insert(e,new iio.Group(a,b));return e};b.prototype.addToGroup=function(a,b,d,e){e=e||0;var h=this.indexOfTag(a,e),k=iio.isNumber(h);if("undefined"==typeof this.cnvs[e].groups||!k)h=this.addGroup(a,
d,e);this.cnvs[e].groups[h].addObj(b,e);"undefined"==typeof this.fps&&"undefined"!=typeof b.pos&&b.draw(this.ctxs[e]);return b};b.prototype.getGroup=function(a,b,d,e){b=b||0;a=this.indexOfTag(a,b);var h=iio.isNumber(a);if("undefined"==typeof this.cnvs[b].groups||!h)return!1;b=this.cnvs[b].groups[a].objs;return"undefined"!==typeof d&&0<=d?b.slice(d,e||d+1):b};b.prototype.addObj=function(a,b,d){d=d||0;"undefined"==typeof this.cnvs[d].groups&&(this.cnvs[d].groups=[]);b=b||0;for(var e=0;e<this.cnvs[d].groups.length;e++)if(0==
this.cnvs[d].groups[e].tag)return this.cnvs[d].groups[e].addObj(a),"undefined"==typeof this.fps&&"undefined"!=typeof a.pos&&a.draw(this.ctxs[d]),a;this.addGroup(b,b,d);this.addToGroup(b,a,b,d);"undefined"==typeof this.fps&&"undefined"!=typeof a.pos&&a.draw(this.ctxs[d]);return a};b.prototype.indexFromzIndexInsertSort=function(a,b){for(var d=0;d<b.length&&b[d].zIndex<a;)d++;return d};b.prototype.indexOfTag=function(a,b){b=b||0;if("undefined"!=typeof this.cnvs[b].groups)for(var d=0;d<this.cnvs[b].groups.length;d++)if(this.cnvs[b].groups[d].tag==
a)return d;return"NO"};b.prototype.setCollisionCallback=function(a,b,d,e){if("undefined"==typeof d||iio.isNumber(d))d=b,b=a;this.cnvs[e||0].groups[this.indexOfTag(a)].addCollisionCallback(b,d)};b.prototype.rmv=function(a,b,d){return iio.isNumber(b)?this.rmvObj(a,b):"undefined"==typeof b?iio.isString(a)?this.rmvGroup(a):this.rmvObj(a):this.rmvFromGroup(b,a,d)};b.prototype.delayRmv=function(a,b,d,e){b.io=this;setTimeout(function(){b.io.rmv(b,d,e)},a)};b.prototype.rmvObj=function(a,b){b=b||0;if("undefined"!=
typeof this.cnvs[b].groups)for(var d=0;d<this.cnvs[b].groups.length;d++)if("undefined"==typeof a.K&&(this.cancelFramerate(a),"undefined"==typeof this.cnvs[b].fps&&a.clearSelf(this.ctxs[b])),this.cnvs[b].groups[d].rmvObj(a))return!0;return!1};b.prototype.rmvGroup=function(a,b){b=b||0;if("undefined"!=typeof this.cnvs[b].groups&&"undefined"!=typeof this.cnvs[b].groups)for(var d=0;d<this.cnvs[b].groups.length;d++)if(this.cnvs[b].groups[d].tag==a)return this.cnvs[b].groups.splice(d,1)};b.prototype.rmvAll=
function(a){if("undefined"==typeof a)for(a=0;a<this.cnvs.length;a++)"undefined"!=typeof this.cnvs[a].groups&&(this.cnvs[a].groups=[]);else"undefined"!=typeof this.cnvs[a].groups&&(this.cnvs[a].groups=[]);return this};b.prototype.rmvFromGroup=function(a,b,d){if("undefined"==typeof d){if(iio.isNumber(b)||"undefined"==typeof b)return this.clearGroup(a,b||0);for(d=0;d<this.cnvs.length;d++)if("undefined"!=typeof this.cnvs[d].groups)for(var e=0;e<this.cnvs[d].groups.length;e++)if(this.cnvs[d].groups[e].tag==
a)return this.cnvs[d].groups[e].rmvObj(b)}else if("undefined"!=typeof this.cnvs[d].groups)for(e=0;e<this.cnvs[d].groups.length;e++)if(this.cnvs[d].groups[e].tag==a)return this.cnvs[d].groups[e].rmvObj(b);return!1};b.prototype.clearGroup=function(a,b){b=b||0;if("undefined"!=typeof this.cnvs[b].groups)for(var d=0;d<this.cnvs[b].groups.length;d++)if(this.cnvs[b].groups[d].tag==a)return this.cnvs[b].groups[d].rmvAll()};b.prototype.setBGColor=function(a,b){this.cnvs[b||0].style.backgroundColor=a;return this};
b.prototype.setBGPattern=function(a,b){this.cnvs[b||0].style.backgroundImage="url('"+a+"')";return this};b.prototype.setBGImage=function(a,b,d){d=iio.isNumber(b)?b:d||0;b?(this.cnvs[d].style.backgroundRepeat="no-repeat",this.cnvs[d].style.background="url(images/bg.jpg) no-repeat center center fixed",this.cnvs[d].style.WebkitBackgroundSize="cover",this.cnvs[d].style.MozBackgroundSize="cover",this.cnvs[d].style.OBackgroundSize="cover",this.cnvs[d].style.backgroundSize="cover",this.cnvs[d].style.Filter=
"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='."+a+"', sizingMethod='scale')",this.cnvs[d].style.MsFilter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+a+"', sizingMethod='scale')"):this.cnvs[d].style.backgroundRepeat="no-repeat";return this.setBGPattern(a,d)};b.prototype.getEventPosition=function(a,b){b=b||0;var d;if(iio.isiPad){if(null==a.touches||null==a.touches.item(0))return-1;new iio.Vec(a.touches.item(0).screenX,a.touches.item(0).screenY)}d=new iio.Vec(a.clientX,a.clientY);
d.sub(this.cnvs[b].pos);return d};b.prototype.getCanvasOffset=function(a){a=this.cnvs[a||0].getBoundingClientRect();return new iio.Vec(a.left,a.top)};b.prototype.getB2BodyAt=function(a,b,d){"undefined"==typeof b.x&&(b=new Box2D.Common.Math.b2Vec2(b,d));a=new Box2D.Collision.b2AABB;a.lowerBound.Set(b.x-0.001,b.y-0.001);a.upperBound.Set(b.x+0.001,b.y+0.001);return this.b2World.QueryAABB(function(a){return a.GetBody().GetType()!=Box2D.Dynamics.b2Body.b2_staticBody&&a.GetShape().TestPoint(a.GetBody().GetTransform(),
b)?a.GetBody():!1},a)}})();
